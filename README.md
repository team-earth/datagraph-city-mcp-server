# DataGraph MCP Server

---

# ðŸš¨ðŸš¨ðŸš¨ STOP! READ THIS FIRST! ðŸš¨ðŸš¨ðŸš¨

## âœ… CORRECT FILE TO EDIT:
```
/home/kkells/datagraph.city/mcp-server/index.js
```

## âŒ DO NOT EDIT THIS FILE:
```
/home/kkells/datagraph-city-mcp-server/index.js  â† WRONG! This is sync target only!
```

---

## Quick Development Workflow

```bash
# 1. Edit the RIGHT file
nano /home/kkells/datagraph.city/mcp-server/index.js

# 2. Commit changes (makes them live in Claude Desktop immediately)
cd /home/kkells/datagraph.city
git add mcp-server/
git commit -m "feat: your change"
git push origin main

# 3. Test in Claude Desktop (restart if needed)
# Changes are LIVE now!

# 4. (Later) Sync to public repo for npm publishing
cd /home/kkells/datagraph.city
./scripts/sync-mcp-to-public.sh
```

---

## Why Two Repos?

**Monorepo (EDIT HERE):**
- `/home/kkells/datagraph.city/mcp-server/` â† **YOUR DEVELOPMENT LOCATION**
- Private repo: `kevinkells/datagraph.city`
- Contains API, frontend, MCP server, everything
- Claude Desktop reads from here: `/home/kkells/datagraph.city/mcp-server/index.js`

**Public Repo (DO NOT EDIT):**
- `/home/kkells/datagraph-city-mcp-server/` â† **SYNC TARGET ONLY**
- Public repo: `team-earth/datagraph-city-mcp-server`
- Auto-synced from monorepo via git subtree
- Published to npm for other users

---

## âš ï¸ Common Mistakes (Don't Do These!)

âŒ Editing `/home/kkells/datagraph-city-mcp-server/index.js`
âœ… Edit `/home/kkells/datagraph.city/mcp-server/index.js` instead

âŒ Committing to `team-earth/datagraph-city-mcp-server` directly
âœ… Commit to `kevinkells/datagraph.city`, then sync

âŒ Forgetting to sync before publishing to npm
âœ… Run `./scripts/sync-mcp-to-public.sh` first

---

---

Model Context Protocol server for accessing DataGraph API from Claude Desktop, ChatGPT, and other MCP-compatible clients.

## GOSR Framework

**ALWAYS SPELL AS: Goal-Obstacles-Solutions-Resources (GOSR)**

GOSR is a participatory problem structuring method:

- **Goal** (singular): The aspirational future picture for a community
- **Obstacles** (plural): Barriers preventing that future from being realized
- **Solutions** (plural): Potential strategies to overcome obstacles IF implemented (these are NOT actual programs)
- **Resources** (plural): Actual programs and initiatives currently operating in the community
- **Actors**: Organizations that run the Resources (in the data model but not explicitly in the GOSR acronym)

**Critical Distinctions:**
- Solutions are theoretical/potential interventions
- Resources are real, existing programs
- Actors are the organizations executing Resources

**Data Structure:**
- Obstacles can have solutions (leaf nodes) OR child obstacles (parent nodes), but not both
- Both Goalâ†’Obstacle and Obstacleâ†’Obstacle use the `HAS_OBSTACLE` relationship type
- Count parent obstacles: `MATCH (parent:Obstacle)-[:HAS_OBSTACLE]->(child:Obstacle) WHERE parent.dataset = 'your-dataset' RETURN COUNT(DISTINCT parent)`
- Count child obstacles: `MATCH (parent:Obstacle)-[:HAS_OBSTACLE]->(child:Obstacle) WHERE parent.dataset = 'your-dataset' RETURN COUNT(child)`

## Installation

### 1. Install Dependencies

```bash
cd mcp-server
npm install
```

### 2. Configure API Key

Create `.env` file:
```bash
cp .env.example .env
# Edit .env and add your API key
```

Or set environment variable:
```bash
export DATAGRAPH_API_KEY="dgc_your_key_here"
```

### 3. Test Locally

```bash
npm start
```

## Using with Claude Desktop

### Configure Claude Desktop

Edit your Claude Desktop config file:

**macOS:** `~/Library/Application Support/Claude/claude_desktop_config.json`
**Windows:** `%APPDATA%\Claude\claude_desktop_config.json`

Add this configuration:

```json
{
  "mcpServers": {
    "datagraph": {
      "command": "node",
      "args": [
        "/absolute/path/to/mcp-server/index.js"
      ],
      "env": {
        "DATAGRAPH_API_KEY": "dgc_your_api_key_here"
      }
    }
  }
}
```

**Or use npx (easier):**

```json
{
  "mcpServers": {
    "datagraph": {
      "command": "npx",
      "args": [
        "-y",
        "datagraph-mcp-server"
      ],
      "env": {
        "DATAGRAPH_API_KEY": "dgc_your_api_key_here"
      }
    }
  }
}
```

### Restart Claude Desktop

Restart Claude Desktop for changes to take effect.

## Example Usage in Claude

Once configured, you can ask Claude:

```
"Using DataGraph, show me recent building permits in Manhattan"

"What are property sale prices by borough in NYC?"

"Show crime statistics for Brooklyn"

"Which NYC neighborhoods have the highest population?"

"Find programs addressing social isolation in NYC"

"What cities are available in DataGraph?"
```

Claude will automatically use the DataGraph MCP server to query the data.

## Available Datasets

**New York City (nyc):**
- **Subway**: 445 MTA stations with lines and locations
- **GOSR (Un-Lonely NYC)**: 7,514 programs addressing urban loneliness
- **DOB Permits**: 856,480 building permits from DOB NOW (March 2021-present)
  - Source: NYC Open Data `rbx6-tga4` - DOB NOW: Build - Approved Permits
  - Includes work types, costs, dates, applicants, owners, building details
- **Property Sales**: 53,464 real estate transactions with prices
- **Crime Data**: 100,000 NYPD complaints with demographics
- **Demographics**: 195 neighborhoods with population statistics

**Kansas City (kc):**
- **GOSR**: 149 violence prevention and community resources

## Available Tools

### `query_city_data`

Query urban data using natural language.

**Parameters:**
- `query` (required): Natural language query
- `locality` (optional): Locality code (default: "nyc")
- `category` (optional): Filter by category
- `limit` (optional): Max results (default: 10)

**Example:**
```json
{
  "query": "Properties under $800K in Brooklyn",
  "locality": "nyc",
  "limit": 5
}
```

### `list_cities`

List all supported cities and their datasets.

### `get_usage_stats`

Get your API usage statistics and quota.

## Development

### Test with MCP Inspector

```bash
npx @modelcontextprotocol/inspector node index.js
```

### Debug Mode

```bash
DEBUG=* npm start
```

## Publishing to NPM (Optional)

To publish as an npm package:

```bash
# 1. Update package.json with your details
# 2. Login to npm
npm login

# 3. Publish
npm publish
```

Then users can install with:
```bash
npx datagraph-mcp-server
```

## Troubleshooting

### "API key not found" error

Make sure your `.env` file exists with correct API key:
```bash
DATAGRAPH_API_KEY=dgc_your_key_here
```

### Claude doesn't see the server

1. Check config file path is correct
2. Use absolute paths, not relative
3. Restart Claude Desktop completely
4. Check Claude Desktop logs for errors

### "Command failed" error

1. Make sure Node.js is installed (`node --version`)
2. Run `npm install` in mcp-server directory
3. Test manually: `node index.js`

## Support

- Documentation: https://docs.datagraph.city/mcp
- Issues: https://github.com/yourusername/datagraph/issues
- Email: support@datagraph.city

